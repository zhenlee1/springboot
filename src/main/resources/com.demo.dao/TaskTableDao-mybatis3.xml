<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.demo.dao.TaskTableDao">
    <resultMap id="BaseResultMap" type="com.demo.domain.TaskTable">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Wed Mar 28 15:09:04 CST 2018.
        -->
        <id column="TASK_TABLE_ID" property="taskTableId" jdbcType="INTEGER"/>
        <result column="TABLE_TYPE" property="tableType" jdbcType="INTEGER"/>
        <result column="TASK_TABLE_NAME" property="taskTableName" jdbcType="VARCHAR"/>
        <result column="TASK_TABLE_BYNAME" property="taskTableByname" jdbcType="VARCHAR"/>
        <result column="TASK_TABLE_DESCRIBE" property="taskTableDescribe" jdbcType="VARCHAR"/>
        <result column="PK_SERIAL" property="pkSerial" jdbcType="VARCHAR"/>
        <result column="CREATE_USER" property="createUser" jdbcType="VARCHAR"/>
        <result column="CREATE_DATE" property="createDate" jdbcType="TIMESTAMP"/>
        <result column="UPDATE_USER" property="updateUser" jdbcType="VARCHAR"/>
        <result column="UPDATE_DATE" property="updateDate" jdbcType="TIMESTAMP"/>
    </resultMap>
    <sql id="Example_Where_Clause">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Wed Mar 28 15:09:04 CST 2018.
        -->
        <where>
            <foreach collection="oredCriteria" item="criteria" separator="or">
                <if test="criteria.valid">
                    <trim prefix="(" suffix=")" prefixOverrides="and">
                        <foreach collection="criteria.criteria" item="criterion">
                            <choose>
                                <when test="criterion.noValue">
                                    and ${criterion.condition}
                                </when>
                                <when test="criterion.singleValue">
                                    and ${criterion.condition} #{criterion.value}
                                </when>
                                <when test="criterion.betweenValue">
                                    and ${criterion.condition} #{criterion.value} and #{criterion.secondValue}
                                </when>
                                <when test="criterion.listValue">
                                    and ${criterion.condition}
                                    <foreach collection="criterion.value" item="listItem" open="(" close=")"
                                             separator=",">
                                        #{listItem}
                                    </foreach>
                                </when>
                            </choose>
                        </foreach>
                    </trim>
                </if>
            </foreach>
        </where>
    </sql>
    <sql id="Update_By_Example_Where_Clause">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Wed Mar 28 15:09:04 CST 2018.
        -->
        <where>
            <foreach collection="example.oredCriteria" item="criteria" separator="or">
                <if test="criteria.valid">
                    <trim prefix="(" suffix=")" prefixOverrides="and">
                        <foreach collection="criteria.criteria" item="criterion">
                            <choose>
                                <when test="criterion.noValue">
                                    and ${criterion.condition}
                                </when>
                                <when test="criterion.singleValue">
                                    and ${criterion.condition} #{criterion.value}
                                </when>
                                <when test="criterion.betweenValue">
                                    and ${criterion.condition} #{criterion.value} and #{criterion.secondValue}
                                </when>
                                <when test="criterion.listValue">
                                    and ${criterion.condition}
                                    <foreach collection="criterion.value" item="listItem" open="(" close=")"
                                             separator=",">
                                        #{listItem}
                                    </foreach>
                                </when>
                            </choose>
                        </foreach>
                    </trim>
                </if>
            </foreach>
        </where>
    </sql>
    <sql id="Base_Column_List">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Wed Mar 28 15:09:04 CST 2018.
        -->
        TASK_TABLE_ID, TABLE_TYPE, TASK_TABLE_NAME, TASK_TABLE_BYNAME, TASK_TABLE_DESCRIBE,
        PK_SERIAL, CREATE_USER, CREATE_DATE, UPDATE_USER, UPDATE_DATE
    </sql>
    <select id="selectByExample" resultMap="BaseResultMap" parameterType="com.demo.domain.TaskTableExample">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Wed Mar 28 15:09:04 CST 2018.
        -->
        select
        <if test="distinct">
            distinct
        </if>
        <include refid="Base_Column_List"/>
        from task_table
        <if test="_parameter != null">
            <include refid="Example_Where_Clause"/>
        </if>
        <if test="orderByClause != null">
            order by ${orderByClause}
        </if>
    </select>
    <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Integer">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Wed Mar 28 15:09:04 CST 2018.
        -->
        select
        <include refid="Base_Column_List"/>
        from task_table
        where TASK_TABLE_ID = #{taskTableId,jdbcType=INTEGER}
    </select>
    <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Wed Mar 28 15:09:04 CST 2018.
        -->
        delete from task_table
        where TASK_TABLE_ID = #{taskTableId,jdbcType=INTEGER}
    </delete>
    <delete id="deleteByExample" parameterType="com.demo.domain.TaskTableExample">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Wed Mar 28 15:09:04 CST 2018.
        -->
        delete from task_table
        <if test="_parameter != null">
            <include refid="Example_Where_Clause"/>
        </if>
    </delete>
    <insert id="insert" parameterType="com.demo.domain.TaskTable">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Wed Mar 28 15:09:04 CST 2018.
        -->
        insert into task_table (TASK_TABLE_ID, TABLE_TYPE, TASK_TABLE_NAME,
        TASK_TABLE_BYNAME, TASK_TABLE_DESCRIBE, PK_SERIAL,
        CREATE_USER, CREATE_DATE, UPDATE_USER,
        UPDATE_DATE)
        values (#{taskTableId,jdbcType=INTEGER}, #{tableType,jdbcType=INTEGER}, #{taskTableName,jdbcType=VARCHAR},
        #{taskTableByname,jdbcType=VARCHAR}, #{taskTableDescribe,jdbcType=VARCHAR}, #{pkSerial,jdbcType=VARCHAR},
        #{createUser,jdbcType=VARCHAR}, #{createDate,jdbcType=TIMESTAMP}, #{updateUser,jdbcType=VARCHAR},
        #{updateDate,jdbcType=TIMESTAMP})
    </insert>
    <insert id="insertSelective" parameterType="com.demo.domain.TaskTable" useGeneratedKeys="true"
            keyProperty="taskTableId">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Wed Mar 28 15:09:04 CST 2018.
        -->
        insert into task_table
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="taskTableId != null">
                TASK_TABLE_ID,
            </if>
            <if test="tableType != null">
                TABLE_TYPE,
            </if>
            <if test="taskTableName != null">
                TASK_TABLE_NAME,
            </if>
            <if test="taskTableByname != null">
                TASK_TABLE_BYNAME,
            </if>
            <if test="taskTableDescribe != null">
                TASK_TABLE_DESCRIBE,
            </if>
            <if test="pkSerial != null">
                PK_SERIAL,
            </if>
            <if test="createUser != null">
                CREATE_USER,
            </if>
            <if test="createDate != null">
                CREATE_DATE,
            </if>
            <if test="updateUser != null">
                UPDATE_USER,
            </if>
            <if test="updateDate != null">
                UPDATE_DATE,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="taskTableId != null">
                #{taskTableId,jdbcType=INTEGER},
            </if>
            <if test="tableType != null">
                #{tableType,jdbcType=INTEGER},
            </if>
            <if test="taskTableName != null">
                #{taskTableName,jdbcType=VARCHAR},
            </if>
            <if test="taskTableByname != null">
                #{taskTableByname,jdbcType=VARCHAR},
            </if>
            <if test="taskTableDescribe != null">
                #{taskTableDescribe,jdbcType=VARCHAR},
            </if>
            <if test="pkSerial != null">
                #{pkSerial,jdbcType=VARCHAR},
            </if>
            <if test="createUser != null">
                #{createUser,jdbcType=VARCHAR},
            </if>
            <if test="createDate != null">
                #{createDate,jdbcType=TIMESTAMP},
            </if>
            <if test="updateUser != null">
                #{updateUser,jdbcType=VARCHAR},
            </if>
            <if test="updateDate != null">
                #{updateDate,jdbcType=TIMESTAMP},
            </if>
        </trim>
    </insert>
    <select id="countByExample" parameterType="com.demo.domain.TaskTableExample" resultType="java.lang.Integer">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Wed Mar 28 15:09:04 CST 2018.
        -->
        select count(*) from task_table
        <if test="_parameter != null">
            <include refid="Example_Where_Clause"/>
        </if>
    </select>
    <update id="updateByExampleSelective" parameterType="map">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Wed Mar 28 15:09:04 CST 2018.
        -->
        update task_table
        <set>
            <if test="record.taskTableId != null">
                TASK_TABLE_ID = #{record.taskTableId,jdbcType=INTEGER},
            </if>
            <if test="record.tableType != null">
                TABLE_TYPE = #{record.tableType,jdbcType=INTEGER},
            </if>
            <if test="record.taskTableName != null">
                TASK_TABLE_NAME = #{record.taskTableName,jdbcType=VARCHAR},
            </if>
            <if test="record.taskTableByname != null">
                TASK_TABLE_BYNAME = #{record.taskTableByname,jdbcType=VARCHAR},
            </if>
            <if test="record.taskTableDescribe != null">
                TASK_TABLE_DESCRIBE = #{record.taskTableDescribe,jdbcType=VARCHAR},
            </if>
            <if test="record.pkSerial != null">
                PK_SERIAL = #{record.pkSerial,jdbcType=VARCHAR},
            </if>
            <if test="record.createUser != null">
                CREATE_USER = #{record.createUser,jdbcType=VARCHAR},
            </if>
            <if test="record.createDate != null">
                CREATE_DATE = #{record.createDate,jdbcType=TIMESTAMP},
            </if>
            <if test="record.updateUser != null">
                UPDATE_USER = #{record.updateUser,jdbcType=VARCHAR},
            </if>
            <if test="record.updateDate != null">
                UPDATE_DATE = #{record.updateDate,jdbcType=TIMESTAMP},
            </if>
        </set>
        <if test="_parameter != null">
            <include refid="Update_By_Example_Where_Clause"/>
        </if>
    </update>
    <update id="updateByExample" parameterType="map">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Wed Mar 28 15:09:04 CST 2018.
        -->
        update task_table
        set TASK_TABLE_ID = #{record.taskTableId,jdbcType=INTEGER},
        TABLE_TYPE = #{record.tableType,jdbcType=INTEGER},
        TASK_TABLE_NAME = #{record.taskTableName,jdbcType=VARCHAR},
        TASK_TABLE_BYNAME = #{record.taskTableByname,jdbcType=VARCHAR},
        TASK_TABLE_DESCRIBE = #{record.taskTableDescribe,jdbcType=VARCHAR},
        PK_SERIAL = #{record.pkSerial,jdbcType=VARCHAR},
        CREATE_USER = #{record.createUser,jdbcType=VARCHAR},
        CREATE_DATE = #{record.createDate,jdbcType=TIMESTAMP},
        UPDATE_USER = #{record.updateUser,jdbcType=VARCHAR},
        UPDATE_DATE = #{record.updateDate,jdbcType=TIMESTAMP}
        <if test="_parameter != null">
            <include refid="Update_By_Example_Where_Clause"/>
        </if>
    </update>
    <update id="updateByPrimaryKeySelective" parameterType="com.demo.domain.TaskTable">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Wed Mar 28 15:09:04 CST 2018.
        -->
        update task_table
        <set>
            <if test="tableType != null">
                TABLE_TYPE = #{tableType,jdbcType=INTEGER},
            </if>
            <if test="taskTableName != null">
                TASK_TABLE_NAME = #{taskTableName,jdbcType=VARCHAR},
            </if>
            <if test="taskTableByname != null">
                TASK_TABLE_BYNAME = #{taskTableByname,jdbcType=VARCHAR},
            </if>
            <if test="taskTableDescribe != null">
                TASK_TABLE_DESCRIBE = #{taskTableDescribe,jdbcType=VARCHAR},
            </if>
            <if test="pkSerial != null">
                PK_SERIAL = #{pkSerial,jdbcType=VARCHAR},
            </if>
            <if test="createUser != null">
                CREATE_USER = #{createUser,jdbcType=VARCHAR},
            </if>
            <if test="createDate != null">
                CREATE_DATE = #{createDate,jdbcType=TIMESTAMP},
            </if>
            <if test="updateUser != null">
                UPDATE_USER = #{updateUser,jdbcType=VARCHAR},
            </if>
            <if test="updateDate != null">
                UPDATE_DATE = #{updateDate,jdbcType=TIMESTAMP},
            </if>
        </set>
        where TASK_TABLE_ID = #{taskTableId,jdbcType=INTEGER}
    </update>
    <update id="updateByPrimaryKey" parameterType="com.demo.domain.TaskTable">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Wed Mar 28 15:09:04 CST 2018.
        -->
        update task_table
        set TABLE_TYPE = #{tableType,jdbcType=INTEGER},
        TASK_TABLE_NAME = #{taskTableName,jdbcType=VARCHAR},
        TASK_TABLE_BYNAME = #{taskTableByname,jdbcType=VARCHAR},
        TASK_TABLE_DESCRIBE = #{taskTableDescribe,jdbcType=VARCHAR},
        PK_SERIAL = #{pkSerial,jdbcType=VARCHAR},
        CREATE_USER = #{createUser,jdbcType=VARCHAR},
        CREATE_DATE = #{createDate,jdbcType=TIMESTAMP},
        UPDATE_USER = #{updateUser,jdbcType=VARCHAR},
        UPDATE_DATE = #{updateDate,jdbcType=TIMESTAMP}
        where TASK_TABLE_ID = #{taskTableId,jdbcType=INTEGER}
    </update>

    <!-- 查询所有要核查的数据表 -->
    <select id="queryTaskTable" resultMap="BaseResultMap">
		SELECT * FROM task_table
	</select>

    <!-- 根据要核查的表确定数据源 -->
    <select id="getTaskDbByTableId" resultType="java.util.HashMap">
        SELECT
        td.*
        FROM
        task_db_table tdt
        LEFT JOIN task_database td ON td.TASK_DB_ID = tdt.TASK_DB_ID
        WHERE
        tdt.TASK_TABLE_ID = #{taskTableId}
    </select>

    <!-- 根据name获取要核查的数据表 -->
    <select id="getTaskTableByName" resultMap="BaseResultMap">
        SELECT
        *
        FROM
        task_table t
        WHERE
        t.TASK_TABLE_NAME = #{taskTableName}
        AND t.TASK_TABLE_ID IN (
        SELECT
        tt.TASK_TABLE_ID
        FROM
        task_db_table tdt
        LEFT JOIN task_database td ON td.TASK_DB_ID = tdt.TASK_DB_ID
        LEFT JOIN task_table tt ON tt.TASK_TABLE_ID = tdt.TASK_TABLE_ID
        WHERE
        tdt.TASK_DB_ID = #{taskDbId}
        )
    </select>

    <!-- 根据条件查询订单的信息，还要分页处理 -->
    <select id="queryTaskTablePageList" resultType="java.util.HashMap" parameterType="map">

        select
        *
        from task_table
        <where>
            <if test="taskTable.taskTableName!=null and taskTable.taskTableName!=''">
                and TASK_TABLE_NAME = #{taskTable.taskTableName,jdbcType=VARCHAR}
            </if>
        </where>
        <if test="firstRow!= null and pageSize!= null">
            <![CDATA[ limit #{firstRow},#{pageSize} ]]>
        </if>
    </select>

    <!-- 根据条件查询订单的信息，还要分页处理 -->
    <select id="queryTaskTableCount" resultType="java.lang.Integer" parameterType="com.demo.domain.TaskTable">
        select
        count(TASK_TABLE_ID)
        from task_table
        <where>
            <if test="taskTableName!=null and taskTableName!=''">
                and TASK_TABLE_NAME = #{taskTableName,jdbcType=VARCHAR}
            </if>
        </where>
    </select>

    <!-- 数据源针对要核查的表的操作 -->
    <!-- 根据核查对象获取所有要核查的数据表 -->
    <select id="queryTaskTableByDB" resultMap="BaseResultMap">
        SELECT
        a.*
        FROM
        task_table a,
        task_db_table b
        WHERE
        a.TASK_TABLE_ID = b.TASK_TABLE_ID
        AND b.TASK_DB_ID = #{taskDbId}
    </select>

    <!-- 新增要核查的数据库表时增加和数据库的关系表 -->
    <insert id="addTDB">
        insert into task_db_table
        (TASK_TABLE_ID,TASK_DB_ID)
        values
        (#{taskTableId},#{taskDbId})
    </insert>

    <!-- 删除数据库下要核查的数据表 只删除关联关系 -->
    <delete id="delTDB">
        delete from
        task_db_table
        where
        TASK_DB_ID = #{taskDbId}
        and
        TASK_TABLE_ID = #{taskTableId}
    </delete>

    <!-- 删除数据库时 删除核查的数据表、表下的字段、参数 -->
    <delete id="delTableByDb">
        delete from
        task_db_table
        where
        TASK_DB_ID = #{taskDbId}
    </delete>

    <!-- 查询数据库下核查表信息，分页处理 -->
    <select id="queryTaskTablePageListByDb" resultType="java.util.HashMap" parameterType="map">

        select
        tt.*
        from task_db_table tdt
        left join task_database td on td.TASK_DB_ID = tdt.TASK_DB_ID
        left join task_table tt on tt.TASK_TABLE_ID = tdt.TASK_TABLE_ID
        <where>
            <if test="taskDbId!=null and taskDbId!=0">
                and tdt.TASK_DB_ID = #{taskDbId,jdbcType=INTEGER}
            </if>
            <if test="taskTable.taskTableName!=null and taskTable.taskTableName!=''">
                and tt.TASK_TABLE_NAME = #{taskTable.taskTableName,jdbcType=VARCHAR}
            </if>
        </where>
        <if test="firstRow!= null and pageSize!= null">
            <![CDATA[ limit #{firstRow},#{pageSize} ]]>
        </if>
    </select>

    <!-- 根据条件查询订单的信息，还要分页处理 -->
    <select id="queryTaskTableCountByDb" resultType="java.lang.Integer" parameterType="map">
        select
        count(tt.TASK_TABLE_ID)
        from task_db_table tdt
        left join task_database td on td.TASK_DB_ID = tdt.TASK_DB_ID
        left join task_table tt on tt.TASK_TABLE_ID = tdt.TASK_TABLE_ID
        <where>
            <if test="taskTable.taskTableName!=null and taskTable.taskTableName!=''">
                and tt.TASK_TABLE_NAME = #{taskTable.taskTableName,jdbcType=VARCHAR}
            </if>
            <if test="taskDbId!=null and taskDbId!=0">
                and td.TASK_DB_ID = #{taskDbId,jdbcType=INTEGER}
            </if>
        </where>
    </select>

    <select id="queryAllTablesByDb" resultType="java.util.HashMap">
	      	SELECT DISTINCT
				T .TABLE_NAME AS TABLENAME,
				F.COMMENTS AS COMMENTS
			FROM
				ALL_TABLES T
			INNER JOIN ALL_TAB_COMMENTS F ON T .TABLE_NAME = F.TABLE_NAME
			WHERE
				F.COMMENTS IS NOT NULL
	  </select>

</mapper>